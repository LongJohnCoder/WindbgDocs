<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"><HTML DIR="LTR" xmlns:MSHelp="http://msdn.microsoft.com/MSHelp">
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<TITLE>Object Reference Tracing</TITLE>
<META NAME="ms.locale" content="en-us">
<META NAME="DESCRIPTION" CONTENT="Debugger, Debugger, Design Guide, Object Reference Tracing"><xml><MSHelp:Keyword Index="A" Term="GFlags_29eddbe3-a557-4bd0-8907-2a58e7b7d9f3.xml"/>
<META NAME="MS-HKWD" CONTENT="Object Reference Tracing">
<META NAME="MS-HKWD" CONTENT="Object Reference Tracing, overview">
<META NAME="MS-HKWD" CONTENT="GFlags, Object Reference Tracing"></xml><LINK REL="stylesheet" type="text/css" href="backsdk4.css"><SCRIPT src="langref.js"></SCRIPT><style>dd {margin-bottom:0em; margin-left:1.9em; }</style>
<style>.divclass {behavior:url(#default#savehistory);}</style>
<META NAME="save" CONTENT="history">
</HEAD>
<Body topmargin="0">
<DIV STYLE="display:none;"></DIV>
<DIV STYLE="display:none;"></DIV>
<TABLE CLASS="buttonbarshade" CELLSPACING="0" border="0"><TR><TD NOWRAP="true"> </TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING="0">
<TR ID="hdr">
<TD NOWRAP="true" CLASS="runninghead">Debugging Tools for Windows</TD>
</TR>
</TABLE>
<H1><A NAME="GFlags_29eddbe3-a557-4bd0-8907-2a58e7b7d9f3.xml"></A>Object Reference Tracing</H1>
<P>The <b>Object Reference Tracing</b> feature records sequential stack traces each time that an object reference counter is incremented or decremented. The traces can help you to detect object reference errors, including double-dereferencing, failure to reference, and failure to dereference objects. This feature is supported only in Windows Vista and later versions of Windows.</P>
<P>For information about configuring the Object Reference Tracing feature in the <b>Global Flags</b> dialog box, see <a href="gflags_4cb53592-1ff3-4f52-b231-e73a72a190ab.xml.htm">Configuring Object Reference Tracing</a>. For information about configuring the Object Reference Tracing feature at the command prompt, see <a href="gflags_63e1eba1-7ac0-4577-b130-ed091210a4c6.xml.htm">GFlags Commands</a>. For an example, see <a href="gflags_5c012392-d8d0-4ee7-b66b-bbe971e1b871.xml.htm">Example 15: Using Object Reference Tracing</a>.</P>
<P>Object reference traces are most useful when you suspect that a particular object is not being referenced or dereferenced properly, typically because increased pool usage indicates that an object is leaking, or a process or session cannot be ended, even though its handle count is zero. Unlike traces that are recorded in logs for later review, object reference traces are designed to be used in real time, while the process is running and the object is being referenced and dereferenced. You view an object reference trace in the debugger by using the <a href="r28_exts_kernel_n_7997a09f-935a-4f81-b729-80fb86b86f79.xml.htm"><b>!obtrace debugger extension</b></a>. Because this extension requires a specified object address, you must know in advance which object is the likely source of the error.</P>
<P></P>
<P>The following rules apply to Object Reference Tracing:</P><B></B><UL type="disc">
<LI>You can run only one object reference trace at a time.</LI>
<LI>Because a kernel-wide trace is not practical, you must limit the trace to objects that are created with specified pool tags, or to objects that are created by a specified process (indicated by an image file name), or both. </LI>
<LI>You can specify only one image file for each trace. If you specify an image file, the trace is limited to objects that are created by the processes that the image represents. Objects that are referenced by the process, but are created by a different process, are not traced.</LI>
<LI>You can specify a maximum of 16 pool tags for each trace. Objects with any of the specified pool tags are traced.</LI>
<LI>If you specify both an image file and one or more pool tags, the trace is limited to objects that are created by the process and have any of the specified pool tags.</LI>
<LI>Object Reference Tracing cannot trace processes that are already running when a trace is started. The trace includes only the objects of processes that start after the trace begins.</LI>
<LI>Objects marked for tracing are traced until the object is destroyed or tracing is disabled. By default, the traces for an object are maintained only until the object is destroyed, but you can specify a "permanent" trace (<b>/p</b>) where the trace is retained until tracing is disabled.</LI>
<LI>You can store the Object Reference Tracing configuration as a registry setting or a kernel flag (run-time) setting. If you have both registry and kernel flag settings, the run-time settings take precedence, but are lost when you shut down or restart the computer.</LI>
</UL>
<P></P>
<P></P>
<DIV style="display:yes"></DIV>
<DIV CLASS="footer"><br><A href="dbglegal.htm">© 2009 Microsoft Corporation</A><br><A href="mailto:windbgfb@microsoft.com?subject=documentation feedback [Debugger]: Object Reference Tracing RELEASE: (December 09, 2009)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AThe WDK team uses the feedback submitted to improve the WDK documentation. We do not use your e-mail address for any other purpose. We will remove your e-mail address from our system after the issue you are reporting has been resolved. While we are working to resolve this issue, we may send you an e-mail message to request more information about your feedback. After the issues have been addressed, we may send you an e-mail message to let you know that your feedback has been addressed.%0A%0AFor more information about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx.
              ">Send feedback on this topic</A><br>Debugging Tools for Windows<br>December 09, 2009<br></DIV>
</Body>
</HTML>
