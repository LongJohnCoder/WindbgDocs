<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"><HTML DIR="LTR" xmlns:MSHelp="http://msdn.microsoft.com/MSHelp">
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<TITLE>Resource Time Outs</TITLE>
<META NAME="ms.locale" content="en-us">
<META NAME="DESCRIPTION" CONTENT="Debugger, Debugger, Design Guide, Resource Time Outs"><xml><MSHelp:Keyword Index="A" Term="t13_advanced_05523b06-9bbf-4117-88f8-166c5fbef9db.xml"/>
<META NAME="MS-HKWD" CONTENT="resource time outs"></xml><LINK REL="stylesheet" type="text/css" href="backsdk4.css"><SCRIPT src="langref.js"></SCRIPT><style>dd {margin-bottom:0em; margin-left:1.9em; }</style>
<style>.divclass {behavior:url(#default#savehistory);}</style>
<META NAME="save" CONTENT="history">
</HEAD>
<Body topmargin="0">
<DIV STYLE="display:none;"></DIV>
<DIV STYLE="display:none;"></DIV>
<TABLE CLASS="buttonbarshade" CELLSPACING="0" border="0"><TR><TD NOWRAP="true"> </TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING="0">
<TR ID="hdr">
<TD NOWRAP="true" CLASS="runninghead">Debugging Tools for Windows</TD>
</TR>
</TABLE>
<H1><A NAME="t13_advanced_05523b06-9bbf-4117-88f8-166c5fbef9db.xml"></A>Resource Time Outs</H1>
<P>During a resource time out, the thread waiting for the resource will break into the kernel debugger with a message similar to the following:</P>
<P style="cursor:text; padding:2pt,4pt;font: 100% Courier New, Courier, mono; color: #660000;"><nobr>Resource @ 800e99c0<BR> ActiveCount = 0001  Flags = IsOwnedExclusive sharedWaiter<BR> NumberOfExclusiveWaiters = 0000<BR>  Thread = 809cd2f0, Count = 01<BR>  Thread = 809ebc50, Count = 01<BR>  Thread = 00000000, Count = 00<BR>  Thread = 00000000, Count = 00<BR>  Thread = 00000000, Count = 00<BR>NT!DbgBreakPoint+0x4:<BR>800cee04: 000000ad callkd <BR></nobr></P>
<P>The thread that holds the lock is the first thread listed (or multiple threads if it is a shared lock). To examine that thread, use a <b>!thread</b> extension on the thread ID (809cd2f0, in the previous example). This will give a stack for the thread owning the resource. If it is also waiting for a resource to become available, either the <b>ExpWaitForResourceExclusive</b> function or the <b>ExpWaitForResourceShared</b> function will be on the stack for that thread. </P>
<P>The first parameter to <b>ExpWaitForResource</b><I><B>Xxx</B></I> is the lock that is being waited on. To find out about that resource, use a <b>!locks &lt;</b><I><B>resource id</B></I><b>&gt;</b> extension, which will give you another thread to check.</P>
<P>If you get to a thread that is not waiting for another resource, that thread is probably the source of the problem. For a list of all held locks, use a <b>!locks</b> extension with no parameter at the <b>kd&gt;</b> prompt.</P>
<H4>Example</H4>
<P style="cursor:text; padding:2pt,4pt;font: 100% Courier New, Courier, mono; color: #660000;"><nobr>Resource @ fc664ee0                  // <i>Here's the resource lock address</i><BR><BR> ActiveCount = 0001  Flags = IsOwnedExclusive ExclusiveWaiter<BR> NumberOfExclusiveWaiters = 0001<BR>  Thread = ffaf5410, Count = 01                // <i>Here's the owning thread</i><BR>  Thread = 00000000, Count = 00<BR>ntoskrnl!_DbgBreakPoint:<BR>80131400 cc               int     3<BR><BR>kd&gt; <b>kb</b>                                        // <i>Start with a stack</i><BR>ChildEBP RetAddr  Args to Child<BR>fcd44980 801154c0 fc664ee0 ffab45d0 00110001 ntoskrnl!_DbgBreakPoint<BR>fcd4499c 80102521 fc664ee0 ffb08ea8 fcd44a4c ntoskrnl!_ExpWaitForResource+0x114        // <i>Lock being waited on...</i><BR><BR>fcd449e8 fc6509fa e12597c8 fef27c08 fee4fca8 ntoskrnl!_ExAcquireResourceExclusiveLite+0xa5<BR>00380020 00000000 00000000 00000000 00000000 nwrdr!_CreateScb+0x2ff<BR><BR>kd&gt; <b>!locks fc664ee0</b>                      // <i>!locks resource address gives lock info</i><BR>Resource @ nwrdr!_NwScavengerSpinLock (0xfc664ee0)    Exclusively owned<BR>    Contention Count = 45<BR>    NumberOfExclusiveWaiters = 1<BR>     Threads: ffaf5410-01                  // <i>Owning thread again</i><BR>1 total locks, 1 locks currently held<BR><BR>kd&gt; <b>!thread ffaf5410</b>                     // <i>Check the owning thread</i><BR><BR>THREAD ffaf5410  Cid e7.e8  Teb: 7ffde000 WAIT: (Executive) KernelMode Non-Alertable<BR>    feecf698  SynchronizationEvent<BR>IRP List:<BR>    fef29208: (0006,00b8) Flags: 00000884  Mdl: feed8328<BR>Not impersonating<BR>Owning Process ffaf5690<BR>WaitTime (seconds)      2781250<BR>Context Switch Count    183175<BR>UserTime                  0:00:23.0153<BR>KernelTime                0:01:01.0187<BR>Start Address 0x77f04644<BR>Initial Sp fec6c000 Current Sp fec6b938<BR>Priority 11 BasePriority 7 PriorityDecrement 0 DecrementCount 8<BR><BR>ChildEBP RetAddr  Args to Child<BR>fec6b950 801044fc feecf668 feecf668 00000080 ntoskrnl!KiSwapContext+0x25<BR>fec6b974 fc655976 feecf698 00000000 00000000 ntoskrnl!_KeWaitForSingleObject+0x218<BR>fec6ba5c fc6509fa e1263968 fef29208 feecf668 nwrdr!_ExchangeWithWait+0x38<BR>fec6ba28 fc6533e5 feecf668 e125b3c8 ffafae08 nwrdr!_CreateScb+0x2ff<BR>fec6bac0 fc652f26 feecf668 fec6bae4 fef29208 nwrdr!_CreateRemoteFile+0x2c9<BR>fec6bb6c fc652b14 feecf668 fef29208 fee50b60 nwrdr!_NwCommonCreate+0x3a2<BR><BR>fec6bbac 80107aea fee50b60 fef29208 804052ac nwrdr!_NwFsdCreate+0x56<BR>fec6bbc0 80142792 fef37700 fec6bdbc fee50b28 ntoskrnl!IofCallDriver+0x38<BR>fec6bd10 80145403 fee50b60 00000000 fec6bdbc ntoskrnl!_IopParseDevice+0x6a0<BR>fec6bd7c 80144c0c 00000000 fec6be34 00000040 ntoskrnl!_ObpLookupObjectName+0x479<BR>fec6be5c 80127803 0012dd64 00000000 80127701 ntoskrnl!_ObOpenObjectByName+0xa2<BR>fec6bef4 801385c3 0012dd64 0012dd3c 00000000 ntoskrnl!_NtQueryAttributesFile+0xc1<BR>fec6bef4 77f716ab 0012dd64 0012dd3c 00000000 ntoskrnl!_KiSystemService+0x83<BR><BR>0012dd20 00000000 00000000 00000000 00000000 ntdll!_ZwQueryAttributesFile+0xb <BR><BR></nobr></P>
<P></P>
<DIV style="display:yes"></DIV>
<DIV CLASS="footer"><br><A href="dbglegal.htm">© 2009 Microsoft Corporation</A><br><A href="mailto:windbgfb@microsoft.com?subject=documentation feedback [Debugger]: Resource Time Outs RELEASE: (December 09, 2009)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AThe WDK team uses the feedback submitted to improve the WDK documentation. We do not use your e-mail address for any other purpose. We will remove your e-mail address from our system after the issue you are reporting has been resolved. While we are working to resolve this issue, we may send you an e-mail message to request more information about your feedback. After the issues have been addressed, we may send you an e-mail message to let you know that your feedback has been addressed.%0A%0AFor more information about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx.
              ">Send feedback on this topic</A><br>Debugging Tools for Windows<br>December 09, 2009<br></DIV>
</Body>
</HTML>
